文章類似検索システム
概要
入力された大量の文章データ（ツイートなど）をAIモデルでベクトル化し、問い合わせたキーワードに意味が近い文章を高速に検索・表示するシステムです。

内部では、AIモデルにcl-tohoku/bert-base-japanese-whole-word-maskingを使用し、類似検索エンジンにはFacebook製のFaissを利用しています。

動作環境
このプロジェクトは、faiss-cpuやtorchといったライブラリのバイナリ互換性の問題から、macOSのローカル環境では動作が不安定になる可能性があります（Segmentation Faultなど）。

そのため、GitHub Codespaces や Docker を利用した、標準的な Linux環境での実行を強く推奨します。

Python: 3.11+

パッケージ管理: Poetry

使い方
1. セットアップ (初回のみ)
プロジェクトをクローンまたはダウンロードした後、ターミナルで以下のコマンドを実行し、必要なライブラリをインストールします。

poetry install

これにより、pyproject.tomlに記述された依存関係が専用の仮想環境にインストールされます。

2. 検索の実行ワークフロー
このシステムは「① データベースの作成」と「② 検索の実行」の2段階で動作します。

① データベースの作成・更新 (get_vec.sh)
まず、検索対象としたい文章のデータを用意し、それをAIが検索できる形式（ベクトルデータベース）に変換します。

プロジェクト内にdataフォルダを作成します。

dataフォルダの中にtweet.jsonlというファイルを作成します。

tweet.jsonlに、1行に1つのJSONオブジェクト形式で、検索させたい文章を記述します。

data/tweet.jsonl の記述例:

{"tweet": ["今日のランチはカレーだった。"]}
{"tweet": ["週末は天気が良さそうなので、ピクニックに行きたい。"]}
{"tweet": ["バイオハザードの新作はとても面白い。"]}

ターミナルで以下のコマンドを実行し、データベースを作成・更新します。

poetry run sh get_vec.sh

このコマンドは、main.pyを呼び出し、data/tweet.jsonlの内容を元にvec_array.npzとexemplars.jsonlという2つのデータベースファイルを生成します。

【重要】 data/tweet.jsonlの内容を変更・追加した場合は、必ずこのコマンドを再実行してデータベースを更新してください。

② 類似文の検索 (load.sh)
作成されたデータベースを使って、キーワードに似た文章を検索します。

load.shファイルを開き、検索したいキーワード（text=の部分）を編集します。

load.sh の編集例:

#!/bin/sh
device=cpu
text=バイオハザード # ← ここのキーワードを変更する

python load.py \
    --text ${text} \
    --device ${device}

ターミナルで以下のコマンドを実行します。

poetry run sh load.sh
```load.py`が実行され、ターミナルに類似度の高い文章とそのスコアが表示されます。


各ファイルの役割
main.py

data/tweet.jsonlを読み込み、文章をベクトルに変換するスクリプト。

ベクトルデータベースvec_array.npzと、それに対応するテキスト一覧exemplars.jsonlを生成します。

load.py

main.pyが生成したデータベースファイルを読み込みます。

入力されたキーワードとの類似度を計算し、結果をターミナルに表示します。

get_vec.sh

main.pyを実行するためのシンプルなラッパースクリプトです。

load.sh

load.pyに検索キーワードを渡して実行するためのラッパースクリプトです。

pyproject.toml

Pythonのパッケージ管理ツールPoetryのプロジェクト定義ファイル。

torchやpandasなど、このプロジェクトが依存するライブラリとそのバージョンが記述されています。

data/tweet.jsonl

ユーザーが用意する、検索対象となる文章の元データです。

vec_array.npz, exemplars.jsonl

get_vec.shによって自動生成される検索用データベースファイルです。

注意点・トラブルシューティング
データ更新後は必ずデータベースの再作成が必要です

data/tweet.jsonlに新しい文章を追加・変更しただけでは、検索結果には反映されません。必ずpoetry run sh get_vec.shを実行して、データベースを更新してください。

検索結果の表示件数について

デフォルトでは、類似度が高い上位5件が表示されるようになっています。

この件数を変更したい場合は、load.pyの37行目あたりにあるpreds=I[0][:5]の数字を変更してください。（例: preds=I[0][:10]にすると上位10件表示になります）

macOSでの動作について

前述の通り、macOSのローカル環境ではライブラリ間のバイナリ互換性の問題でSegmentation faultエラーが発生し、動作しない可能性があります。問題が発生した場合は、GitHub Codespacesなど、Linuxベースの環境で実行することを強く推奨します。